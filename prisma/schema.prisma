datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model Product {
  id           String    @id @default(cuid())
  sku          String?   @unique
  name_en      String?
  name_pl      String?
  name_de      String?
  description_en String?
  description_pl String?
  description_de String?
  supplierName String?
  supplierLink String?
  priceComment String?
  stock        Int?
  price        Int?
  sizeLength   Int?
  sizeWidth    Int?
  weight       Int?
  length       Int?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  images       ProductImage[]
  catalogs     ProductCatalog[]
}

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model ImageFile {
  id          String        @id @default(cuid())
  filename    String
  filepath    String
  mimetype    String
  size        Int
  width       Int?
  height      Int?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  products    ProductImage[] // Relation to the join table
}

enum CurrencyCode {
  USD
  EUR
  PLN
  GBP
}

enum CountryCode {
  PL
  DE
  GB
  US
}

model Currency {
  id        String       @id @default(cuid())
  code      CurrencyCode @unique
  name      String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  priceGroups PriceGroup[]
}

model Country {
  id        String   @id @default(cuid())
  code      CountryCode @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Integration {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  connections IntegrationConnection[]
}

model IntegrationConnection {
  id            String      @id @default(cuid())
  integrationId String      @unique
  name          String
  username      String
  password      String
  playwrightStorageState String?
  playwrightStorageStateUpdatedAt DateTime?
  playwrightHeadless Boolean @default(true)
  playwrightSlowMo Int @default(50)
  playwrightTimeout Int @default(15000)
  playwrightNavigationTimeout Int @default(30000)
  playwrightHumanizeMouse Boolean @default(false)
  playwrightMouseJitter Int @default(6)
  playwrightClickDelayMin Int @default(30)
  playwrightClickDelayMax Int @default(120)
  playwrightInputDelayMin Int @default(20)
  playwrightInputDelayMax Int @default(120)
  playwrightActionDelayMin Int @default(200)
  playwrightActionDelayMax Int @default(900)
  playwrightProxyEnabled Boolean @default(false)
  playwrightProxyServer String?
  playwrightProxyUsername String?
  playwrightProxyPassword String?
  playwrightEmulateDevice Boolean @default(false)
  playwrightDeviceName String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  integration   Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)
}

model PriceGroup {
  id               String      @id @default(cuid())
  groupId          String      @unique
  isDefault        Boolean     @default(false)
  name             String
  description      String?
  currencyId       String
  type             String
  basePriceField   String
  sourceGroupId    String?
  priceMultiplier  Float       @default(1)
  addToPrice       Int         @default(0)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  currency         Currency    @relation(fields: [currencyId], references: [id])
  sourceGroup      PriceGroup? @relation("PriceGroupDependency", fields: [sourceGroupId], references: [id])
  dependentGroups  PriceGroup[] @relation("PriceGroupDependency")
}

model ProductImage {
  productId   String
  imageFileId String
  assignedAt  DateTime @default(now())

  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  imageFile   ImageFile @relation(fields: [imageFileId], references: [id], onDelete: Cascade)

  @@id([productId, imageFileId])
}

model Catalog {
  id          String          @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  products    ProductCatalog[]
}

model ProductCatalog {
  productId   String
  catalogId   String
  assignedAt  DateTime @default(now())

  product     Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  catalog     Catalog @relation(fields: [catalogId], references: [id], onDelete: Cascade)

  @@id([productId, catalogId])
}

model Slug {
  id        String   @id @default(cuid())
  slug      String   @unique
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  pages     PageSlug[]
}

model Page {
  id          String          @id @default(cuid())
  name        String
  slugs       PageSlug[]
  components  PageComponent[]
  blocks      PageBlock[]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

model PageSlug {
  pageId    String
  slugId    String
  assignedAt DateTime @default(now())

  page      Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)
  slug      Slug     @relation(fields: [slugId], references: [id], onDelete: Cascade)

  @@id([pageId, slugId])
}

model PageComponent {
  id        String   @id @default(cuid())
  type      String   // e.g., 'hero', 'text', 'image'
  order     Int
  content   Json
  pageId    String
  page      Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Block {
  id        String   @id @default(cuid())
  name      String   @unique
  content   Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  pages     PageBlock[]
}

model PageBlock {
  pageId    String
  blockId   String
  assignedAt DateTime @default(now())

  page      Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)
  block     Block    @relation(fields: [blockId], references: [id], onDelete: Cascade)

  @@id([pageId, blockId])
}
